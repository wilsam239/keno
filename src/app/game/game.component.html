<section fxLayout="column" id="game-container">
  <div class="header" fxLayout="row" fxLayoutGap="12px">
    <div class="spacer-label">spacer</div>
    <div class="result-header" fxLayout="row" fxFill fxLayoutGap="4px">
      <a
        id="back-container"
        class="clickable"
        fxLayout="column"
        fxLayoutAlign=" center"
        [routerLink]="['../', AppRoutes.SETUP]"
      >
        <div id="back-title">Setup</div>
        <div class="tile back-tile" fxLayoutAlign="center center">
          <mat-icon>arrow_back_ios</mat-icon>
        </div>
      </a>
      <div
        id="run-container"
        class="clickable"
        fxLayout="column"
        fxLayoutAlign=" center"
        (click)="retry()"
      >
        <div id="run-title">Again</div>
        <div class="tile run-tile" fxLayoutAlign="center center">
          <mat-icon>refresh</mat-icon>
        </div>
      </div>

      <div class="spacer-tile tile"></div>
      <div class="spacer-tile tile"></div>

      <div id="heads-container" fxLayout="column" fxLayoutAlign=" center">
        <div id="heads-title">Heads</div>
        <div
          id="heads-count"
          class="tile heads-tile"
          fxLayoutAlign="center center"
        >
          {{ headCount }}
        </div>
      </div>
      <div id="tails-container" fxLayout="column" fxLayoutAlign=" center">
        <div id="tails-title">Tails</div>
        <div
          id="tails-count"
          class="tile tails-tile"
          fxLayoutAlign="center center"
        >
          {{ tailCount }}
        </div>
      </div>
      <div
        id="game-id"
        class="big-tile"
        fxLayoutAlign="center center"
        fxLayout="column"
        fxLayoutGap="1vw"
      >
        <div class="big-tile-header">
          <div>GAME</div>
        </div>
        <div>{{ gameNumber }}</div>
      </div>
      <ng-container *ngIf="gameFinished; else faster">
        <ng-container
          *ngIf="gameNumber < (config?.games ?? 0); else allFinished"
        >
          <div
            id="time-until-next"
            class="big-tile"
            fxLayoutAlign="center center"
            fxLayout="column"
            fxLayoutGap="1vw"
          >
            <div class="big-tile-header">
              <div>NEXT GAME IN</div>
            </div>
            <div>0:{{ secondsTilNext }}</div>
          </div>
        </ng-container>
        <ng-template #allFinished>
          <div
            id="all-games-finished"
            class="big-tile clickable"
            fxLayoutAlign="center center"
            fxLayout="column"
            fxLayoutGap="1vw"
            (click)="showSummary = true; gs.dialogOpened = true"
          >
            <div class="big-tile-header">
              <div>RESULT</div>
            </div>
            <div>{{ payout | currency }}</div>
          </div>
        </ng-template>
      </ng-container>
      <ng-template #faster>
        <div
          id="fast-forward"
          class="big-tile clickable"
          fxLayoutAlign="center center"
          (click)="changeDrawTime()"
          fxLayout="column"
          fxLayoutGap="1vw"
        >
          <div class="big-tile-header">
            <div>{{ fast ? "SLOWER" : "FASTER" }}</div>
          </div>
          <mat-icon [ngClass]="{ clicked: fast }">fast_forward</mat-icon>
        </div>
      </ng-template>
    </div>
  </div>

  <div class="board" fxLayout="column" fxLayoutGap="12px">
    <ng-container
      *ngTemplateOutlet="
        boardSection;
        context: { className: 'heads', tileList: headTiles }
      "
    ></ng-container>
    <ng-container
      *ngTemplateOutlet="
        boardSection;
        context: { className: 'tails', tileList: tailTiles }
      "
    ></ng-container>
  </div>
</section>

<ng-template #boardSection let-className="className" let-tileList="tileList">
  <div fxLayout="row" fxLayoutGap="12px">
    <div
      id="{{ className }}-board-label"
      class="{{ className }}-tile"
      fxLayout="row"
      fxLayoutAlign="center center"
    >
      <span class="board-label">{{ className | titlecase }}</span>
    </div>
    <div
      [class]="className + '-tiles'"
      fxFlex
      fxLayoutGap="4px"
      fxLayout="row wrap"
    >
      <ng-container
        *ngTemplateOutlet="tileTemplate; context: { tiles: tileList }"
      ></ng-container>
    </div>
  </div>
</ng-template>

<ng-template #tileTemplate let-tiles="tiles">
  <div
    *ngFor="let tile of tiles"
    class="tile"
    fxLayoutAlign="center center"
    [id]="'tile-' + tile"
  >
    {{ tile }}
  </div>
</ng-template>

<section
  id="game-summary"
  *ngIf="gameNumber == config.games! && gameFinished && showSummary"
>
  <h1>Games Summary</h1>
  <div fxLayout="column">
    <div
      id="games-played"
      class="big-tile"
      fxLayoutAlign="center center"
      fxLayout="column"
      fxLayoutGap="4px"
    >
      <div class="big-tile-header">
        <div>GAMES PLAYED</div>
      </div>
      <div>{{ config.games }}</div>
    </div>
    <div
      id="payout"
      class="big-tile"
      fxLayoutAlign="center center"
      fxLayout="column"
      fxLayoutGap="4px"
    >
      <div class="big-tile-header">
        <div>PAYOUT</div>
      </div>
      <div>{{ payout | currency }}</div>
    </div>
    <div
      id="games-played"
      class="big-tile"
      fxLayoutAlign="center center"
      fxLayout="column"
      fxLayoutGap="4px"
    >
      <div class="big-tile-header">
        <div>SPENT</div>
      </div>
      <div>{{ config.games! * config.bet! | currency }}</div>
    </div>
    <div
      id="head-count-summary"
      class="big-tile"
      fxLayoutAlign="center center"
      fxLayout="column"
      fxLayoutGap="4px"
    >
      <div class="big-tile-header">
        <div>HEAD COUNT</div>
      </div>
      <div>{{ totalHeadCount }}</div>
    </div>
    <div
      id="tail-count-summary"
      class="big-tile"
      fxLayoutAlign="center center"
      fxLayout="column"
      fxLayoutGap="4px"
    >
      <div class="big-tile-header">
        <div>TAIL COUNT</div>
      </div>
      <div>{{ totalTailCount }}</div>
    </div>
    <div
      id="even-count-summary"
      class="big-tile"
      fxLayoutAlign="center center"
      fxLayout="column"
      fxLayoutGap="4px"
    >
      <div class="big-tile-header">
        <div>EVEN COUNT</div>
      </div>
      <div>{{ totalEvenCount }}</div>
    </div>
  </div>
</section>
